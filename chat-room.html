<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Room | Nexus Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/chat-room.css">
</head>
<body>

    <!-- Room Header -->
    <header class="room-header">
        <div class="header-content">
            <a href="chat.html" class="back-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </a>
            <div class="room-info" onclick="ChatRoom.showRoomDetails()">
                <div class="room-avatar" id="roomAvatar">ðŸšŒ</div>
                <div class="room-meta">
                    <h1 id="roomName">Delhi Trip Squad</h1>
                    <span class="room-status" id="roomStatus">
                        <span class="online-dot"></span>
                        12 online â€¢ 24 members
                    </span>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="ChatRoom.toggleSearch()">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                </button>
                <button class="icon-btn" onclick="ChatRoom.showMenu()">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <circle cx="12" cy="5" r="2"/>
                        <circle cx="12" cy="12" r="2"/>
                        <circle cx="12" cy="19" r="2"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Pinned Event Banner -->
        <div class="pinned-banner" id="pinnedBanner">
            <div class="pin-icon">ðŸ“Œ</div>
            <div class="pin-content">
                <span class="pin-label">Linked Event</span>
                <span class="pin-title">Delhi â†’ Mumbai Bus â€¢ Mar 15</span>
            </div>
            <button class="pin-action" onclick="ChatRoom.viewEvent()">View</button>
        </div>
    </header>

    <!-- Search Bar (Hidden by default) -->
    <div class="search-bar hidden" id="searchBar">
        <div class="search-input-wrap">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
            </svg>
            <input type="text" placeholder="Search in conversation..." id="searchMessages">
            <button class="close-search" onclick="ChatRoom.toggleSearch()">Ã—</button>
        </div>
    </div>

    <!-- Messages Container -->
    <main class="messages-container" id="messagesContainer">
        <div class="messages-wrap" id="messagesWrap">
            <!-- Date Divider -->
            <div class="date-divider">
                <span>Today</span>
            </div>

            <!-- System Message -->
            <div class="system-message">
                <span>Rahul created this group for Delhi Trip</span>
            </div>

            <!-- Messages populated by JS -->
        </div>
    </main>

    <!-- Typing Indicator -->
    <div class="typing-indicator hidden" id="typingIndicator">
        <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <span>Alex is typing...</span>
    </div>

    <!-- Quick Actions Bar -->
    <div class="quick-actions" id="quickActions">
        <button class="quick-chip" onclick="ChatRoom.sendQuick('Who all are coming?')">
            Who all are coming?
        </button>
        <button class="quick-chip" onclick="ChatRoom.sendQuick('Share your location ðŸ“')">
            Share location
        </button>
        <button class="quick-chip" onclick="ChatRoom.createGroupBooking()">
            + Create Group Booking
        </button>
    </div>

    <!-- Input Area -->
    <footer class="input-area">
        <div class="input-toolbar">
            <button class="tool-btn" onclick="ChatRoom.attachFile()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                </svg>
            </button>
            <button class="tool-btn" onclick="ChatRoom.openCamera()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                    <circle cx="12" cy="13" r="4"/>
                </svg>
            </button>
        </div>
        <div class="message-input-wrap">
            <input type="text" 
                   class="message-input" 
                   id="messageInput" 
                   placeholder="Message..." 
                   autocomplete="off">
            <button class="send-btn" onclick="ChatRoom.sendMessage()" id="sendBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="22" y1="2" x2="11" y2="13"/>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                </svg>
            </button>
        </div>
    </footer>

    <!-- Room Details Modal -->
    <div class="modal hidden" id="roomDetailsModal">
        <div class="modal-overlay" onclick="ChatRoom.closeModal()"></div>
        <div class="modal-sheet details-sheet">
            <div class="sheet-drag-handle"></div>
            <div class="room-details-header">
                <div class="details-avatar" id="detailsAvatar">ðŸšŒ</div>
                <h2 id="detailsName">Delhi Trip Squad</h2>
                <p id="detailsMeta">Created by Rahul â€¢ 24 members</p>
            </div>
            
            <div class="details-section">
                <h3>Members</h3>
                <div class="members-list" id="membersList">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="details-section">
                <h3>Linked Event</h3>
                <div class="linked-event-card" onclick="ChatRoom.viewEvent()">
                    <div class="event-icon">ðŸšŒ</div>
                    <div class="event-details">
                        <span class="event-title">Delhi â†’ Mumbai</span>
                        <span class="event-time">Mar 15, 6:00 AM</span>
                    </div>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </div>
            </div>

            <div class="details-actions">
                <button class="action-btn mute" onclick="ChatRoom.muteNotifications()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <line x1="23" y1="9" x2="17" y2="15"/>
                        <line x1="17" y1="9" x2="23" y2="15"/>
                    </svg>
                    Mute Notifications
                </button>
                <button class="action-btn exit" onclick="ChatRoom.exitGroup()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                    </svg>
                    Exit Group
                </button>
            </div>
        </div>
    </div>

    <!-- Group Booking Modal -->
    <div class="modal hidden" id="groupBookingModal">
        <div class="modal-overlay" onclick="ChatRoom.closeModal()"></div>
        <div class="modal-sheet">
            <div class="sheet-header">
                <h3>Create Group Booking</h3>
                <button class="close-btn" onclick="ChatRoom.closeModal()">Ã—</button>
            </div>
            <p class="modal-desc">Invite room members to split payment</p>
            
            <div class="booking-preview">
                <div class="preview-icon">ðŸšŒ</div>
                <div class="preview-info">
                    <span class="preview-title">Delhi â†’ Mumbai</span>
                    <span class="preview-price">â‚¹2,000 per person</span>
                </div>
            </div>

            <div class="split-options">
                <label class="split-option">
                    <input type="radio" name="split" value="equal" checked>
                    <div class="option-content">
                        <span class="option-title">Split Equally</span>
                        <span class="option-desc">Everyone pays â‚¹500</span>
                    </div>
                </label>
                <label class="split-option">
                    <input type="radio" name="split" value="custom">
                    <div class="option-content">
                        <span class="option-title">Custom Split</span>
                        <span class="option-desc">You decide who pays what</span>
                    </div>
                </label>
            </div>

            <button class="create-booking-btn" onclick="ChatRoom.confirmGroupBooking()">
                Create & Share in Room
            </button>
        </div>
    </div>

    <!-- Menu Dropdown -->
    <div class="dropdown hidden" id="menuDropdown">
        <button class="dropdown-item" onclick="ChatRoom.clearChat()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Clear Chat
        </button>
        <button class="dropdown-item" onclick="ChatRoom.reportGroup()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            Report
        </button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script src="js/chat-room.js"></script>
</body>
</html>